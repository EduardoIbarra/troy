<div class="container">
  <div class="center">
    <h3>Fecha: {{today | date:'d/M/yyyy'}}</h3>
  </div>
  <div>
    <div class="row">
      <div class="col-md-6">
        <button class="btn btn-block btn-primary" *ngIf="step > 1" button full icon-start (click)="previous()"><span name="arrow-dropleft-circle"></span> Atrás</button>
      </div>
      <div class="col-md-6">
        <button class="btn btn-block btn-primary" *ngIf="step !== last_step" button full icon-end (click)="next()">Siguiente <span name="arrow-dropright-circle"></span></button>
        <button class="btn btn-block btn-primary" *ngIf="step === last_step && !showing" button full icon-end (click)="finish()" color="secondary">Actualizar <span name="checkmark-circle"></span></button>
      </div>
    </div>
    <hr />
  </div>

  <div *ngIf="step === 1">
    <div class="row">
      <div class="col-md-6">
        <h5>Resistencia del Sist. de Tierras</h5>
        <div>
          <div>
            <label color="primary" floating>Inicial (OHM)</label>
            <input  [(ngModel)]="form.tierra_inicial" type="number" class="form-control">
          </div>
          <div>
            <label color="primary" floating>Final (OHM)</label>
            <input  [(ngModel)]="form.tierra_final" type="number" class="form-control">
          </div>
        </div>
      </div>
      <div class="col-md-6">
        <h5>Voltaje</h5>
        <div>
          <div>
            <label color="primary" floating>Inicial (V)</label>
            <input  [(ngModel)]="form.voltaje_inicial" type="number" class="form-control">
          </div>
          <div>
            <label color="primary" floating>Final (V)</label>
            <input  [(ngModel)]="form.voltaje_final" type="number" class="form-control">
          </div>
        </div>
      </div>
    </div>
    <div class="row">
      <div class="col-md-6">
        <h5>Amperaje</h5>
        <div>
          <div>
            <label color="primary" floating>Inicial (A)</label>
            <input  [(ngModel)]="form.amperaje_inicial" type="number" class="form-control">
          </div>
          <div>
            <label color="primary" floating>Final (A)</label>
            <input  [(ngModel)]="form.amperaje_final" type="number" class="form-control">
          </div>
        </div>
      </div>
      <div class="col-md-6">
        <h5>Optimizador</h5>
        <div>
          <div>
            <label color="primary" floating>Número de Serie</label>
            <input  [(ngModel)]="form.serie" type="text" class="form-control">
          </div>
        </div>
      </div>
    </div>
  </div>

  <div *ngIf="step === 2">
    <h5>Datos del Usuario</h5>
    <div class="row">
      <div class="col-md-6">
        <div>
          <div>
            <label color="primary" floating># de Medidor</label>
            <input  [(ngModel)]="form.medidor" type="text" class="form-control" (keyup.enter)="searchMedidor()">
            <button  clear item-right button (click)="searchMedidor()">
              Buscar
            </button>
          </div>
          <div>
            <label color="primary" floating>RPU</label>
            <input  [(ngModel)]="form.rpu" type="text" class="form-control">
          </div>
          <div>
            <label color="primary" floating>Nombre</label>
            <input  [(ngModel)]="form.nombre" type="text" class="form-control">
          </div>
        </div>
      </div>
      <div class="col-md-6">
        <div>
          <div>
            <label color="primary" floating>Calle</label>
            <input  [(ngModel)]="form.calle" type="text" class="form-control">
          </div>
          <div>
            <label color="primary" floating>Colonia</label>
            <input  [(ngModel)]="form.colonia" type="text" class="form-control">
          </div>
          <div>
            <label color="primary" floating>Ciudad</label>
            <input  [(ngModel)]="form.ciudad" type="text" class="form-control">
          </div>
        </div>
      </div>
    </div>
  </div>

  <div *ngIf="step === 3">
    <h5>Materiales Utilizados</h5>
    <div class="row">
      <div class="col-md-6">
        <div>
          <div>
            <label color="primary" floating>Instaló</label>
            <select class="form-control"  [(ngModel)]="form.instalo">
              <option [value]="e" *ngFor="let e of employees">({{e.ciudad}}) {{e.nombre}}</option>
            </select>
          </div>
        </div>
      </div>
      <div class="col-md-6">
        <div>
          <div>
            <label color="primary" floating>Supervisó</label>
            <select class="form-control"  [(ngModel)]="form.superviso">
              <option [value]="s" *ngFor="let s of supervisores">{{s.name}} {{s.last_name}}</option>
            </select>
          </div>
        </div>
      </div>
    </div>
    <div class="row">
      <div class="col-md-6">
        <div>
          <div>
            <label color="primary" floating>Pintura</label>
            <select class="form-control"  [(ngModel)]="form.pintura">
              <option value="si">Sí</option>
              <option value="no">No</option>
            </select>
          </div>
        </div>
      </div>
      <div class="col-md-6">
        <div>
          <div>
            <label color="primary" floating>Obra Civil</label>
            <select class="form-control"  [(ngModel)]="form.obra_civil">
              <option value="si">Sí</option>
              <option value="no">No</option>
            </select>
          </div>
        </div>
      </div>
      <div class="col-md-6">
        <div>
          <div>
            <label color="primary" floating>Varilla a Tierra</label>
            <select class="form-control"  [(ngModel)]="form.varilla">
              <option value="si">Sí</option>
              <option value="no">No</option>
            </select>
          </div>
        </div>
      </div>
    </div>
    <div class="row">
      <div class="col-md-6">
        <div>
          <div>
            <label color="primary" floating>Observaciones</label>
            <textarea  [(ngModel)]="form.observaciones" type="text" class="form-control"></textarea>
          </div>
        </div>
      </div>
    </div>
    <h5 class="center">Agregar Materiales</h5>
    <table class="table table-bordered table-hover table-striped table-dark">
      <tr>
        <th>Cantidad</th>
        <th>Unidad</th>
        <th>Material</th>
      </tr>
      <ng-container *ngFor="let m of form.current_materials">
        <tr>
          <td><input  placeholder="0" [(ngModel)]="m.current_quantity" type="number" class="form-control"></td>
          <td>{{m.unidad}}</td>
          <td>{{m.descripcion}}</td>
        </tr>
      </ng-container>
    </table>
  </div>

  <div *ngIf="step === 4">
    <div #map id="map"></div>
    <iframe *ngIf="form.geolocation" [src]="sanitizer.bypassSecurityTrustResourceUrl('https://maps.google.com/maps?q='+form.geolocation.lat+','+form.geolocation.lng+'&hl=es;z=14&amp;output=embed')" width="100%" height="250" frameborder="0" style="border:0" allowfullscreen></iframe>
    <div class="row">
      <div class="col-md-4">
        <input type="number" class="form-control" [(ngModel)]="form.geolocation.lat" placeholder="Latitud">
      </div>
      <div class="col-md-4">
        <input type="number" class="form-control" [(ngModel)]="form.geolocation.lng" placeholder="Longitud">
      </div>
    </div>
  </div>

  <div *ngIf="step === 5">
    <div class="row" *ngIf="form.pictures">
      <div class="col-md-4" *ngFor="let p of form.pictures">
        <img [src]="p" class="framePicture img-fluid" />
      </div>
    </div>
    <div class="row" *ngIf="form.pictures">
      <b>No se capturaron imágenes</b>
    </div>
  </div>

  <div *ngIf="step === 6">
    <div>
      <div class="row">
        <div class="col-md-6">
          <img [src]="form.firmaCFE" alt="">
        </div>
        <div class="col-md-6">
          <img [src]="form.firmaTroy" alt="">
        </div>
      </div>
    </div>
    <div>
      <div class="row">
        <div class="col-md-6">
          <div class="signatureContainer center" *ngIf="firmaTroy">
            <img [src]="firmaTroy">
            <br />
            <b *ngIf="form.superviso">{{form.superviso.name}} {{form.superviso.last_name}}</b><br />
            <span>Supervisor Troy</span>
          </div>
        </div>
        <div class="col-md-6">
          <div class="signatureContainer center" *ngIf="firmaCFE">
            <img [src]="firmaCFE">
            <br />
            <b *ngIf="form.CFENombre">{{form.CFENombre}}</b><br />
            <span>Supervisor CFE</span>
          </div>
        </div>
      </div>
      <h3>Para Supervisor CFE:</h3>
      <div class="row">
        <div class="col-md-6">
          <div>
            <label color="primary" floating>Nombre</label>
            <input  [(ngModel)]="form.CFENombre" type="text" class="form-control">
          </div>
        </div>
        <div class="col-md-6">
          <div>
            <label color="primary" floating>RPE/RTT</label>
            <input  [(ngModel)]="form.CFERpe" type="text" class="form-control">
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
